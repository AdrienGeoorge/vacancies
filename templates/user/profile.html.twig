{% extends 'base.html.twig' %}

{% block title %}{{ app_name }} - Profil de {{ user.firstname ~ ' ' ~ user.lastname }}{% endblock %}

{% block content %}
    {{ parent() }}
    <input type="hidden" value="{{ user.id }}" id="userId">
    <div class="px-4 md:px-8 flex gap-4 items-start flex-col sm:flex-row">
        <div class="w-full sm:sticky top-4 flex flex-col gap-4 sm:w-80">
            <div class="shadow rounded-3xl bg-box dark:bg-box-dark">
                <div class="h-40 w-full relative bg-cover rounded-t-3xl"
                     style="background-image: url({{ asset('/build/images/profile-cover.png') }});">
                    <div class="absolute left-1/2 -translate-x-1/2 -bottom-1/2 border-4 rounded-full overflow-hidden">
                        {% if app.user.avatar %}
                            <img src="{{ user.avatar }}" alt="Mon profil" class="w-40 h-40">
                        {% else %}
                            <div class="w-40 h-40 flex items-center justify-center text-white text-8xl font-poppins"
                                 style="background-color: #495963;">
                                {{ user.firstname|first }}
                            </div>
                        {% endif %}
                    </div>
                </div>
                <div class="mt-20 py-6 px-8 text-center">
                    <div class="flex flex-col gap-1 justify-center items-center">
                        <div class="text-2xl font-poppins-semi-bold">{{ user.completeName }}</div>
                        {% if user == app.user and user.privateProfile %}
                            <button class="bg-body dark:bg-body-dark flex gap-2 justify-center items-center px-3 py-1 rounded-full">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                     stroke-width="1.5" stroke="currentColor" class="size-4">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"></path>
                                </svg>
                                <span class="font-tenor">Profil privé</span>
                            </button>
                        {% endif %}
                    </div>

                    {% set followStatus = user.follows|filter(f => f.followedBy == app.user) %}
                    {% if user == app.user %}
                        <button
                                class="mt-4 tracking-wide bg-blue-500 border-2 border-blue-400 text-white w-fit m-auto
                                    py-2 px-4 rounded-full flex items-center justify-center hover:bg-blue600
                                    transition-all duration-300 ease-in-out focus:shadow-outline focus:outline-none">
                            Modifier mon profil
                        </button>
                    {% elseif followStatus|length == 1 %}
                        {% if followStatus|first.isApproved %}
                            <button
                                    class="mt-4 tracking-wide bg-gray-700 text-white border-gray-500 hover:bg-gray-800 w-fit m-auto
                                    py-2 px-4 rounded-full flex items-center justify-center border-2
                                    dark:bg-white dark:text-gray-700 dark:border-gray-300 hover:dark:bg-gray-200
                                    transition-all duration-300 ease-in-out focus:shadow-outline focus:outline-none followButton">
                                Ne plus suivre
                            </button>
                        {% else %}
                            <button
                                    class="mt-4 tracking-wide bg-gray-700 text-white border-gray-500 hover:bg-gray-800 w-fit m-auto
                                    py-2 px-4 rounded-full flex items-center justify-center border-2
                                    dark:bg-white dark:text-gray-700 dark:border-gray-300 hover:dark:bg-gray-200
                                    transition-all duration-300 ease-in-out focus:shadow-outline focus:outline-none followButton">
                                Demande de suivi en attente
                            </button>
                        {% endif %}
                    {% else %}
                        <button
                                class="mt-4 tracking-wide bg-gray-700 text-white border-gray-500 hover:bg-gray-800 w-fit m-auto
                                    py-2 px-4 rounded-full flex items-center justify-center border-2
                                    dark:bg-white dark:text-gray-700 dark:border-gray-300 hover:dark:bg-gray-200
                                    transition-all duration-300 ease-in-out focus:shadow-outline focus:outline-none followButton">
                            {% if user.privateProfile %}
                                Demander à suivre
                            {% else %}
                                Suivre
                            {% endif %}
                        </button>
                    {% endif %}
                </div>
            </div>

            <div class="shadow rounded-3xl bg-box dark:bg-box-dark p-4">
                <div class="flex gap-5 justify-center">
                    <div class="flex flex-1 flex-col items-center bg-teal-500 border-teal-400 border-4 text-white p-4 rounded-3xl justify-center text-center">
                        <div class="font-roboto-medium text-2xl">{{ passedTrips }}</div>
                        <div class="font-roboto-thin leading-5">{{ passedTrips > 1 ? 'Voyages réalisés' : 'Voyage réalisé' }}</div>
                    </div>
                    <div class="flex flex-1 flex-col items-center bg-amber-400 border-amber-300 border-4 text-white p-4 rounded-3xl justify-center text-center">
                        <div class="font-roboto-medium text-2xl">{{ countPassedCountries }}</div>
                        <div class="font-roboto-thin leading-5">{{ countPassedCountries > 1 ? 'Pays découverts' : 'Pays découvert' }}</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="flex-1 grid grid-cols-1 lg:grid-cols-2 gap-4">
            <div class="shadow rounded-3xl bg-box dark:bg-box-dark py-3.5 px-6">
                <div class="mb-2 flex flex-row items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                         stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z"></path>
                    </svg>
                    <div class="font-poppins-semi-bold text-xl">Écussons de route</div>
                </div>
                <div class="mt-4">
                    {% if user.userBadges|length > 0 %}
                        <div class="grid gap-5 grid-cols-[repeat(auto-fill,minmax(135px,1fr))] sm:grid-cols-[repeat(auto-fill,minmax(110px,1fr))]">
                            {% for badge in user.userBadges %}
                                <div class="flex flex-col gap-3 text-center">
                                    <img src="{{ asset('build/images/badges/' ~ badge.name ~ '_'~ badge.level ~ '.svg') }}" alt="{{ badge.title }}">
                                    <div class="text-sm leading-3 font-roboto">{{ badge.description }}</div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-lg">Aucun écussion sur son étendard... mais chaque aventure est un premier pas!</div>
                    {% endif %}
                </div>
            </div>
            <div class="col-2">test</div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('profile') }}
{% endblock %}