{% extends 'base.html.twig' %}

{% block title %}{{ app_name }} - Profil de {{ user.firstname ~ ' ' ~ user.lastname }}{% endblock %}

{% block content %}
    {{ parent() }}
    <input type="hidden" value="{{ user.id }}" id="userId">
    <div class="px-4 xl:px-8">
        <div class="rounded-4xl bg-box dark:bg-box-dark p-4">
            <div class="h-60 w-full relative bg-cover rounded-3xl z-0"
                 style="background-image: url({{ asset('/build/images/profile-cover.png') }});">
            </div>
        </div>
        <div class="w-10/12 md:w-4/5 lg:w-2/3 -mt-20 flex flex-col gap-4 relative z-10 mx-auto">
            <div class="flex flex-col lg:flex-row justify-between items-center gap-4 lg:gap-6
                    bg-box dark:bg-box-dark rounded-4xl p-4">
                <div class="left-side flex flex-col sm:flex-row items-center gap-4 sm:gap-6">
                    <div class="border-4 rounded-3xl overflow-hidden w-32 h-32">
                        {% if user.avatar %}
                            <img src="{{ user.avatar }}" alt="Mon profil" class="w-32 h-32">
                        {% else %}
                            <div class="w-32 h-32 text-white text-7xl font-poppins relative"
                                 style="background-color: #495963;">
                                <span class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
                                    {{ user.firstname|first }}
                                </span>
                            </div>
                        {% endif %}
                    </div>
                    <div class="text-center sm:text-left">
                        <div class="text-2xl font-poppins-semi-bold">{{ user.completeName }}</div>
                        {% if user.biography %}
                            <div class="text-lg font-bold font-roboto-thin text-gray-500 dark:text-gray-300">
                                « {{ user.biography }} »
                            </div>
                        {% endif %}
                        <div class="mt-2 text-sm flex gap-1 items-center">
                            <div class="bg-body rounded-full py-1 px-3 flex gap-2 dark:text-black">
                                <div class="font-bold" id="countFollows">{{ user.approvedFollows|length }}</div>
                                <div>{{ user.approvedFollows|length > 1 ? 'Abonnés' : 'Abonné' }}</div>
                            </div>
                            <div class="separator">•</div>
                            <div class="bg-body rounded-full py-1 px-3 flex gap-2 dark:text-black">
                                <div class="font-bold" id="countFollowedBy">{{ user.approvedFollowedBy|length }}</div>
                                <div>{{ user.approvedFollowedBy|length > 1 ? 'Abonnements' : 'Abonnement' }}</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="right-side flex flex-col md:flex-row lg:flex-col gap-2 items-center w-64">
                    <button class="bg-body dark:bg-body-dark flex gap-2 justify-center items-center px-3 py-1 rounded-full {{ user == app.user ? 'canChangeVisibility' }}">
                        {% if user.isPrivateProfile %}
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                 stroke-width="1.5" stroke="currentColor" class="size-4 profile-visibility-icon">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                      d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"></path>
                            </svg>
                            <span class="font-tenor profile-visibility">Profil privé</span>
                        {% else %}
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                 stroke-width="1.5" stroke="currentColor" class="size-4 profile-visibility-icon">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                      d="M13.5 10.5V6.75a4.5 4.5 0 1 1 9 0v3.75M3.75 21.75h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H3.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"></path>
                            </svg>
                            <span class="font-tenor profile-visibility">Profil public</span>
                        {% endif %}
                    </button>

                    {% set followStatus = user.follows|filter(f => f.followedBy == app.user) %}
                    {% if user == app.user %}
                        <button
                                class="tracking-wide bg-blue-500 border-2 border-blue-400 text-white w-fit m-auto
                                    py-2 px-4 rounded-2xl flex items-center justify-center hover:bg-blue600
                                    transition-all duration-300 ease-in-out focus:shadow-outline focus:outline-none"
                                onclick="alert('warning','Modification du profil indisponible pour le moment.')">
                            Modifier mon profil
                        </button>
                    {% elseif followStatus|length == 1 %}
                        {% if followStatus|first.isApproved %}
                            <button
                                    class="tracking-wide bg-gray-700 text-white border-gray-500 hover:bg-gray-800 w-fit m-auto
                                    py-2 px-4 rounded-2xl flex items-center justify-center border-2
                                    dark:bg-white dark:text-gray-700 dark:border-gray-300 hover:dark:bg-gray-200
                                    transition-all duration-300 ease-in-out focus:shadow-outline focus:outline-none followButton">
                                Ne plus suivre
                            </button>
                        {% else %}
                            <button
                                    class="tracking-wide bg-gray-700 text-white border-gray-500 hover:bg-gray-800 w-fit m-auto
                                    py-2 px-4 rounded-2xl flex items-center justify-center border-2
                                    dark:bg-white dark:text-gray-700 dark:border-gray-300 hover:dark:bg-gray-200
                                    transition-all duration-300 ease-in-out focus:shadow-outline focus:outline-none followButton">
                                Demande de suivi en attente
                            </button>
                        {% endif %}
                    {% else %}
                        <button
                                class="tracking-wide bg-gray-700 text-white border-gray-500 hover:bg-gray-800 w-fit m-auto
                                    py-2 px-4 rounded-2xl flex items-center justify-center border-2
                                    dark:bg-white dark:text-gray-700 dark:border-gray-300 hover:dark:bg-gray-200
                                    transition-all duration-300 ease-in-out focus:shadow-outline focus:outline-none followButton">
                            {% if user.privateProfile %}
                                Demander à suivre
                            {% else %}
                                Suivre
                            {% endif %}
                        </button>
                    {% endif %}
                </div>
            </div>
            {% if user.isPrivateProfile and user != app.user %}
                <div class="bg-box dark:bg-box-dark rounded-4xl pt-3 pb-6 px-6 flex flex-col text-center">
                    <div class="text-2xl">Ce profil est privé.</div>
                    <div class="text-lg">Suivez ce compte pour visualiser ses statistiques et ses voyages.</div>
                </div>
            {% else %}
                <div class="bg-box dark:bg-box-dark rounded-4xl pt-3 pb-6 px-6">
                    <div class="font-poppins-semi-bold text-xl">Statistiques de voyages</div>
                    <div class="flex gap-4 flex-wrap mt-4">
                        <div class="flex flex-1 flex-col items-center bg-body dark:bg-body-dark dark:text-white p-4 rounded-3xl justify-center text-center">
                            <div class="font-roboto-medium text-2xl">{{ passedTrips }}</div>
                            <div class="font-roboto-thin leading-5">{{ passedTrips > 1 ? 'Voyages réalisés' : 'Voyage réalisé' }}</div>
                        </div>
                        <div class="flex flex-1 flex-col items-center bg-body dark:bg-body-dark dark:text-white p-4 rounded-3xl justify-center text-center">
                            <div class="font-roboto-medium text-2xl">{{ countPassedCountries }}</div>
                            <div class="font-roboto-thin leading-5">{{ countPassedCountries > 1 ? 'Pays découverts' : 'Pays découvert' }}</div>
                        </div>
                        <div class="flex flex-1 flex-col items-center bg-body dark:bg-body-dark dark:text-white p-4 rounded-3xl justify-center text-center">
                            <div class="font-roboto-medium text-xl">
                                {% if countryMostVisited %}
                                    {{ countryMostVisited.countryCode|country_name }}
                                {% else %}
                                    Aucune
                                {% endif %}
                            </div>
                            <div class="font-roboto-thin leading-5">Destination préférée</div>
                        </div>
                    </div>
                </div>
                <div class="bg-box dark:bg-box-dark rounded-4xl py-3.5 px-6">
                    <div class="mb-2 flex flex-row items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                             stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z"></path>
                        </svg>
                        <div class="font-poppins-semi-bold text-xl">Écussons de route</div>
                    </div>
                    {% if user.userBadges|length > 0 %}
                        <div class="mt-5 grid gap-5 grid-cols-[repeat(auto-fill,minmax(120px,1fr))] xl:grid-cols-[repeat(auto-fill,minmax(135px,1fr))]">
                            {% for badge in user.userBadges|slice(0,6) %}
                                <div class="flex flex-col gap-3 text-center">
                                    <img src="{{ asset('build/images/badges/' ~ badge.name ~ '_'~ badge.level ~ '.svg') }}"
                                         alt="{{ badge.title }}">
                                    <div class="flex flex-col gap-2 text-sm font-roboto leading-4">
                                        <div class="font-bold">{{ badge.title }}</div>
                                        <div>{{ badge.description }}</div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-lg mt-2">
                            Aucun écussion sur son étendard... mais chaque aventure est un premier pas!
                        </div>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('profile') }}
{% endblock %}